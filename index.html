<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>Leaderboard</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font/dist/font-face.css" rel="stylesheet" type="text/css" />
    <style>
        body {
            font-family: 'Vazir', Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        /* Two-column layout for leaderboard */
        .columns-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        .column {
            width: 48%;
        }
        .color-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            margin-right: 10px;
            background-color: #6C7A89; /* Gray-bluish color */
        }
        .leaderboard-entry {
            display: flex;
            align-items: center;
            margin: 10px auto;
            padding: 10px;
            width: 90%;
            border: 2px solid #d83939;
            border-radius: 50px;
            box-sizing: border-box;
        }
        .leaderboard-entry .name {
            font-weight: bold;
            margin-right: auto;
        }
        .leaderboard-entry .score {
            font-size: 1.5em;
            font-weight: bold;
            color: #d83939;
            margin-right: 20px;
        }

        /* Store section styles */
        .section-divider {
            margin: 40px 0;
            border-top: 1px solid #ddd;
        }
        #store-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .item-card {
            width: 240px;
            height: 320px;
            perspective: 1000px;
            cursor: pointer;
            margin: 15px;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .card-front {
            background-color: #f9f9f9;
        }
        .card-back {
            background-color: #ffffff;
            transform: rotateY(180deg);
        }
        .item-image {
            width: 80%;
            height: auto;
            object-fit: cover;
            margin-bottom: 15px;
        }
        .item-name {
            font-weight: bold;
            margin: 10px 0;
        }
        .item-price {
            color: #e63946;
            font-weight: bold;
        }
        .qr-image {
            width: 70%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>لیــــدربـــــرد مغـــــازه</h1>
    <div class="columns-container">
        <div id="leaderboard-left" class="column"></div>
        <div id="leaderboard-right" class="column"></div>
    </div>

    <div class="section-divider"></div>

    <h1>Store</h1>
    <div id="store-container"></div>

    <script>
        const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRM_bD3CHrtSDMOt2-iJ04wbivtj99QdolG2ehTI1ZD8kkYyMA5rL4b-LFyTy6KSXQiJWeP_1sW9SUK/pub?output=csv";

        function parseCSV(csv) {
            const lines = csv.trim().split("\n");
            return lines.slice(1).map(line => {
                const [Photo, Name, Score] = line.split(",");
                return { Name, Score: parseInt(Score, 10) };
            });
        }

        function randomCharacter() {
            const chars = ['❂', '✼', '❖', '❉', '⌘'];
            return chars[Math.floor(Math.random() * chars.length)];
        }

        function convertToPersianNumber(number) {
            const persianDigits = '۰۱۲۳۴۵۶۷۸۹';
            return number.toString().replace(/\d/g, (digit) => persianDigits[digit]);
        }

        fetch(sheetURL)
            .then(response => response.text())
            .then(csvText => {
                const data = parseCSV(csvText);
                data.sort((a, b) => b.Score - a.Score);

                const leaderboardLeft = document.getElementById("leaderboard-left");
                const leaderboardRight = document.getElementById("leaderboard-right");

                data.forEach((entry, index) => {
                    const row = document.createElement("div");
                    row.className = "leaderboard-entry";

                    const circle = document.createElement("div");
                    circle.className = "color-circle";
                    circle.textContent = randomCharacter();

                    const nameSpan = document.createElement("div");
                    nameSpan.className = "name";
                    nameSpan.textContent = entry.Name;

                    const scoreSpan = document.createElement("div");
                    scoreSpan.className = "score";
                    scoreSpan.textContent = convertToPersianNumber(entry.Score);

                    row.appendChild(circle);
                    row.appendChild(nameSpan);
                    row.appendChild(scoreSpan);

                    if (index % 2 === 0) {
                        leaderboardLeft.appendChild(row);
                    } else {
                        leaderboardRight.appendChild(row);
                    }
                });

                addStoreItems();
            })
            .catch(error => {
                console.error("Error fetching or parsing CSV:", error);
            });

        function addStoreItems() {
            function getRandomEmoji() {
                const emojis = ["😀", "🚀", "🎮", "🎁", "💎", "🏆", "⭐️", "🔥", "💫", "🎯", "🎨", "🎭", "🎧", "📱", "🎪"];
                return emojis[Math.floor(Math.random() * emojis.length)];
            }

            const storeItems = [
                {
                    name: "Premium Avatar",
                    image: "https://via.placeholder.com/240x200",
                    price: 500,
                    qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=item1",
                },
                {
                    name: "Special Badge",
                    image: "https://via.placeholder.com/240x200",
                    price: 300,
                    qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=item2",
                },
                {
                    name: "Extra Points",
                    image: "https://via.placeholder.com/240x200",
                    price: 200,
                    qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=item3",
                },
                {
                    name: "Unique Theme",
                    image: "https://via.placeholder.com/240x200",
                    price: 450,
                    qrCode: "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=item4",
                },
            ];

            const storeContainer = document.getElementById("store-container");

            storeItems.forEach((item) => {
                const card = document.createElement("div");
                card.className = "item-card";

                const cardInner = document.createElement("div");
                cardInner.className = "card-inner";

                const cardFront = document.createElement("div");
                cardFront.className = "card-front";

                const emojiSpan = document.createElement("span");
                emojiSpan.textContent = getRandomEmoji();
                emojiSpan.style.fontSize = "40px";
                emojiSpan.style.display = "block";
                emojiSpan.style.marginBottom = "10px";

                const itemImage = document.createElement("img");
                itemImage.className = "item-image";
                itemImage.src = item.image;
                itemImage.alt = item.name;

                const itemName = document.createElement("div");
                itemName.className = "item-name";
                itemName.textContent = item.name;

                const itemPrice = document.createElement("div");
                itemPrice.className = "item-price";
                itemPrice.textContent = `قیمت ${item.price}`;

                cardFront.appendChild(emojiSpan);
                cardFront.appendChild(itemImage);
                cardFront.appendChild(itemName);
                cardFront.appendChild(itemPrice);

                const cardBack = document.createElement("div");
                cardBack.className = "card-back";

                const qrImage = document.createElement("img");
                qrImage.className = "qr-image";
                qrImage.src = item.qrCode;
                qrImage.alt = "QR Code";

                cardBack.appendChild(qrImage);

                cardInner.appendChild(cardFront);
                cardInner.appendChild(cardBack);
                card.appendChild(cardInner);

                card.addEventListener("click", function () {
                    if (cardInner.style.transform === "rotateY(180deg)") {
                        cardInner.style.transform = "rotateY(0deg)";
                    } else {
                        cardInner.style.transform = "rotateY(180deg)";
                    }
                });

                storeContainer.appendChild(card);
            });
        }
    </script>
</body>
</html>
